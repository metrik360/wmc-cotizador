<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WMC Soluciones Met√°licas - Cotizador</title>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/styles.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
</head>
<body>
    <div class="app">
        <aside class="sidebar">
            <div class="logo">
                <img src="https://i.ibb.co/zVRsqhBp/Picture1.jpg" alt="WMC Logo" style="height: 40px; width: auto;">
            </div>
            <nav class="nav-section">
                <div class="nav-label">Principal</div>
                <div class="nav-item active" data-view="dashboard">
                    <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/></svg>
                    Dashboard
                </div>
                <div class="nav-item" data-view="cotizaciones">
                    <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
                    Cotizaciones
                </div>
            </nav>
            <nav class="nav-section">
                <div class="nav-label">Cat√°logos</div>
                <div class="nav-item" data-view="clientes">
                    <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"/></svg>
                    Clientes
                </div>
                <div class="nav-item" data-view="productos">
                    <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"/></svg>
                    Productos
                </div>
                <div class="nav-item" data-view="materiales">
                    <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"/></svg>
                    Materiales
                </div>
                <div class="nav-item" data-view="manoobra">
                    <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/><path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/></svg>
                    Mano de Obra
                </div>
            </nav>
            <div class="sidebar-footer">
                <!-- Google Sheets Sync Status -->
                <div id="sync-status" class="sync-status" style="display: none;">
                    <div class="sync-status-header">
                        <svg id="sync-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" style="width: 16px; height: 16px;">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                        </svg>
                        <span id="sync-status-text">Sincronizado</span>
                    </div>
                    <div id="sync-details" class="sync-details"></div>
                    <button id="sync-manual-btn" class="btn btn-sm btn-secondary" style="width: 100%; margin-top: 8px;" onclick="manualSync()">
                        Sincronizar ahora
                    </button>
                </div>

                <div class="nav-item" data-view="config">
                    <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"/></svg>
                    Configuraci√≥n
                </div>
                <div class="powered-by">
                    <span>Powered by</span>
                    <img src="https://i.ibb.co/sdb3Bpq5/M-trik-logo-iso.png" alt="M√©TRIK">
                </div>
            </div>
        </aside>
        <main class="main">
            <div class="view active" id="view-dashboard">
                <header class="header">
                    <h1 class="header-title">Dashboard</h1>
                    <div class="header-actions">
                        <button class="btn btn-primary" onclick="openNewQuote()">+ Nueva Cotizaci√≥n</button>
                    </div>
                </header>
                <div class="content">
                    <div class="stats-grid">
                        <div class="stat-card"><div class="stat-label">Cotizaciones este mes</div><div class="stat-value" id="stat-month">0</div></div>
                        <div class="stat-card"><div class="stat-label">Pendientes</div><div class="stat-value" id="stat-pending">0</div></div>
                        <div class="stat-card"><div class="stat-label">Aprobadas</div><div class="stat-value" id="stat-approved">0</div></div>
                        <div class="stat-card"><div class="stat-label">Valor total cotizado</div><div class="stat-value accent" id="stat-total">$0</div></div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Cotizaciones Recientes</h3>
                            <button class="btn btn-ghost btn-sm" onclick="switchView('cotizaciones')">Ver todas</button>
                        </div>
                        <div class="table-container">
                            <table><thead><tr><th>N¬∫</th><th>Cliente</th><th>Proyecto</th><th>Fecha</th><th>Total</th><th>Estado</th><th></th></tr></thead><tbody id="recent-quotes"></tbody></table>
                        </div>
                    </div>
                </div>
            </div>
            <div class="view" id="view-cotizaciones">
                <header class="header">
                    <h1 class="header-title">Cotizaciones</h1>
                    <div class="header-actions">
                        <div class="search-box">
                            <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/></svg>
                            <input type="text" placeholder="Buscar..." id="search-quotes" onkeyup="filterQuotes()">
                        </div>
                        <button class="btn btn-primary" onclick="openNewQuote()">+ Nueva Cotizaci√≥n</button>
                    </div>
                </header>
                <div class="content">
                    <div class="card" style="padding:16px;margin-bottom:16px">
                        <div class="form-row">
                            <div class="form-group" style="max-width:250px">
                                <label class="form-label">Filtrar por Cliente</label>
                                <select class="form-input" id="filter-quotes-client" onchange="filterQuotes()">
                                    <option value="">Todos los clientes</option>
                                </select>
                            </div>
                            <div class="form-group" style="max-width:180px">
                                <label class="form-label">Filtrar por Estado</label>
                                <select class="form-input" id="filter-quotes-status" onchange="filterQuotes()">
                                    <option value="">Todos los estados</option>
                                    <option value="pending">Pendiente</option>
                                    <option value="approved">Aprobada</option>
                                    <option value="rejected">Rechazada</option>
                                </select>
                            </div>
                            <div class="form-group" style="max-width:170px">
                                <label class="form-label">Fecha Desde</label>
                                <input type="date" class="form-input" id="filter-quotes-date-from" onchange="filterQuotes()">
                            </div>
                            <div class="form-group" style="max-width:170px">
                                <label class="form-label">Fecha Hasta</label>
                                <input type="date" class="form-input" id="filter-quotes-date-to" onchange="filterQuotes()">
                            </div>
                            <div class="form-group" style="display:flex;align-items:flex-end">
                                <button class="btn btn-secondary" onclick="clearQuoteFilters()">Limpiar Filtros</button>
                            </div>
                        </div>
                    </div>
                    <div class="card"><div class="table-container"><table><thead><tr><th>N¬∫</th><th>Fecha</th><th>Cliente</th><th>Proyecto</th><th>Items</th><th>Total</th><th>Estado</th><th></th></tr></thead><tbody id="all-quotes"></tbody></table></div></div>
                </div>
            </div>
            <div class="view" id="view-clientes">
                <header class="header"><h1 class="header-title">Clientes</h1><div class="header-actions"><button class="btn btn-primary" onclick="openClientModal()">+ Nuevo Cliente</button></div></header>
                <div class="content"><div class="card"><div class="table-container"><table><thead><tr><th>Empresa</th><th>NIT</th><th>Contacto</th><th>Tel√©fono</th><th>Email</th><th>Ciudad</th><th></th></tr></thead><tbody id="clients-table"></tbody></table></div></div></div>
            </div>
            <div class="view" id="view-materiales">
                <header class="header"><h1 class="header-title">Cat√°logo de Materiales</h1><div class="header-actions"><button class="btn btn-primary" onclick="openMaterialModal()">+ Nuevo Material</button></div></header>
                <div class="content">
                    <div class="card" style="padding:16px;margin-bottom:16px">
                        <div class="form-row">
                            <div class="form-group" style="max-width:200px">
                                <label class="form-label">Filtrar por Tipo</label>
                                <select class="form-input" id="filter-materials-type" onchange="filterMaterials()">
                                    <option value="">Todos</option>
                                </select>
                            </div>
                            <div class="form-group" style="display:flex;align-items:flex-end">
                                <button class="btn btn-secondary" onclick="clearMaterialFilters()">Limpiar Filtros</button>
                            </div>
                        </div>
                    </div>
                    <div class="card"><div class="table-container"><table><thead><tr><th>C√≥digo</th><th>Descripci√≥n</th><th>Tipo</th><th>Unidad</th><th>Precio Unitario</th><th></th></tr></thead><tbody id="materials-table"></tbody></table></div></div>
                </div>
            </div>
            <div class="view" id="view-manoobra">
                <header class="header"><h1 class="header-title">Cat√°logo de Mano de Obra</h1><div class="header-actions"><button class="btn btn-primary" onclick="openLaborModal()">+ Nueva Actividad</button></div></header>
                <div class="content">
                    <div class="card" style="padding:16px;margin-bottom:16px">
                        <div class="form-row">
                            <div class="form-group" style="max-width:200px">
                                <label class="form-label">Filtrar por Tipo</label>
                                <select class="form-input" id="filter-labor-type" onchange="filterLabor()">
                                    <option value="">Todos</option>
                                    <option value="fabricacion">Fabricaci√≥n</option>
                                    <option value="instalacion">Instalaci√≥n</option>
                                </select>
                            </div>
                            <div class="form-group" style="display:flex;align-items:flex-end">
                                <button class="btn btn-secondary" onclick="clearLaborFilters()">Limpiar Filtros</button>
                            </div>
                        </div>
                    </div>
                    <div class="card"><div class="table-container"><table><thead><tr><th>C√≥digo</th><th>Actividad</th><th>Tipo</th><th>Unidad</th><th>Costo Base</th><th></th></tr></thead><tbody id="labor-table"></tbody></table></div></div>
                </div>
            </div>
            <div class="view" id="view-productos">
                <header class="header">
                    <h1 class="header-title">Cat√°logo de Productos y Servicios</h1>
                    <div class="header-actions">
                        <button class="btn btn-primary" onclick="openProductModal()">+ Nuevo Producto/Servicio</button>
                    </div>
                </header>
                <div class="content">
                    <div class="card" style="padding:16px;margin-bottom:16px">
                        <div class="form-row">
                            <div class="form-group" style="max-width:200px">
                                <label class="form-label">Filtrar por Tipo</label>
                                <select class="form-input" id="filter-products-type" onchange="filterProducts()">
                                    <option value="">Todos</option>
                                    <option value="producto">Productos</option>
                                    <option value="servicio">Servicios</option>
                                </select>
                            </div>
                            <div class="form-group" style="display:flex;align-items:flex-end">
                                <button class="btn btn-secondary" onclick="clearProductFilters()">Limpiar Filtros</button>
                            </div>
                        </div>
                    </div>
                    <div class="card">
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>C√≥digo</th>
                                        <th>Nombre</th>
                                        <th>Tipo</th>
                                        <th>Materiales</th>
                                        <th>Mano de Obra</th>
                                        <th>Precio Unitario</th>
                                        <th></th>
                                    </tr>
                                </thead>
                                <tbody id="products-table"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            <div class="view" id="view-config">
                <header class="header"><h1 class="header-title">Configuraci√≥n</h1></header>
                <div class="content">
                    <div class="card" style="max-width:600px">
                        <div class="card-header"><h3 class="card-title">Valores por Defecto</h3></div>
                        <div class="card-body">
                            <div class="form-row">
                                <div class="form-group"><label class="form-label">Administraci√≥n (%)</label><input type="number" class="form-input" id="config-admin" value="7"></div>
                                <div class="form-group"><label class="form-label">Imprevistos (%)</label><input type="number" class="form-input" id="config-imprevistos" value="7"></div>
                                <div class="form-group"><label class="form-label">Utilidad (%)</label><input type="number" class="form-input" id="config-utilidad" value="5"></div>
                            </div>
                            <div class="form-row">
                                <div class="form-group"><label class="form-label">IVA (%)</label><input type="number" class="form-input" id="config-iva" value="19"></div>
                                <div class="form-group"><label class="form-label">Vigencia (d√≠as)</label><input type="number" class="form-input" id="config-vigencia" value="20"></div>
                            </div>
                            <div class="form-row">
                                <div class="form-group"><label class="form-label">Margen Suministro (%)</label><input type="number" class="form-input" id="config-margen-suministro" value="30"></div>
                                <div class="form-group"><label class="form-label">Margen Instalaci√≥n (%)</label><input type="number" class="form-input" id="config-margen-instalacion" value="45"></div>
                            </div>
                            <div class="form-group"><label class="form-label">Observaciones por Defecto</label><textarea class="form-textarea" id="config-observaciones" rows="8"></textarea></div>
                            <button class="btn btn-primary" onclick="saveConfig()">Guardar Configuraci√≥n</button>
                        </div>
                    </div>

                    <!-- Google Sheets Integration Card -->
                    <div class="card" style="max-width:600px;margin-top:24px">
                        <div class="card-header">
                            <h3 class="card-title">Sincronizaci√≥n con Google Sheets</h3>
                        </div>
                        <div class="card-body">
                            <p style="color:var(--text-secondary);margin-bottom:20px">
                                Conecta tu cuenta de Google para sincronizar autom√°ticamente todos tus datos con Google Sheets.
                            </p>
                            <div id="google-status-display" style="padding:16px;background:var(--bg-tertiary);border-radius:8px;margin-bottom:16px">
                                <div style="display:flex;align-items:center;gap:12px">
                                    <svg style="width:20px;height:20px;color:var(--text-muted)" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                                    </svg>
                                    <div>
                                        <div style="font-weight:600;margin-bottom:4px">Estado: No conectado</div>
                                        <div style="font-size:12px;color:var(--text-muted)">Los datos se guardan solo localmente</div>
                                    </div>
                                </div>
                            </div>
                            <button class="btn btn-primary" onclick="openGoogleSetup()">
                                <svg style="width:18px;height:18px;margin-right:8px" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" fill="#4285F4"/>
                                    <path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/>
                                    <path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"/>
                                    <path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/>
                                </svg>
                                Configurar Google Sheets
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Modal: Cotizaci√≥n -->
    <div class="modal-overlay" id="modal-quote">
        <div class="modal" style="max-width:1000px">
            <div class="modal-header"><h2 class="modal-title" id="quote-modal-title">Nueva Cotizaci√≥n</h2><div class="modal-close" onclick="closeModal('modal-quote')">‚úï</div></div>
            <div class="modal-body">
                <div class="form-row">
                    <div class="form-group autocomplete-container">
                        <label class="form-label">Cliente *</label>
                        <input type="text" class="form-input" id="quote-client" placeholder="Buscar cliente..." autocomplete="off" oninput="searchClients(this.value)">
                        <input type="hidden" id="quote-client-id">
                        <div class="autocomplete-list" id="client-autocomplete"></div>
                    </div>
                    <div class="form-group"><label class="form-label">NIT</label><input type="text" class="form-input" id="quote-nit" readonly></div>
                    <div class="form-group"><label class="form-label">Proyecto *</label><input type="text" class="form-input" id="quote-project"></div>
                </div>
                <div class="form-row">
                    <div class="form-group" style="max-width:250px">
                        <label class="form-label">Estado</label>
                        <select class="form-input" id="quote-status">
                            <option value="pending">Pendiente</option>
                            <option value="approved">Aprobada</option>
                            <option value="rejected">Rechazada</option>
                        </select>
                    </div>
                </div>

                <div class="section-title" style="margin-top:20px">Productos y Servicios</div>
                <div class="table-container">
                    <table style="font-size:13px">
                        <thead>
                            <tr>
                                <th style="width:35%">Producto/Servicio</th>
                                <th style="width:12%">Tipo</th>
                                <th style="width:12%">Cantidad</th>
                                <th style="width:15%">Precio Unit.</th>
                                <th style="width:10%">Desc. %</th>
                                <th style="width:16%">Subtotal</th>
                                <th style="width:5%"></th>
                            </tr>
                        </thead>
                        <tbody id="quote-items-lines"></tbody>
                    </table>
                </div>
                <button class="btn btn-secondary btn-sm" onclick="addQuoteItemLine()" style="margin-top:10px">+ Agregar Producto/Servicio</button>

                <div class="form-row" style="margin-top:24px">
                    <div class="form-group" style="max-width:250px">
                        <label class="form-label">Descuento General (%)</label>
                        <input type="number" class="form-input" id="quote-general-discount" value="0" min="0" max="100" step="0.1" onchange="calculateQuoteTotals()">
                    </div>
                </div>

                <div class="section-title">Observaciones</div>
                <div class="form-group"><textarea class="form-textarea" id="quote-observations" rows="5"></textarea></div>

                <div class="totals-section">
                    <div class="totals-box">
                        <div class="total-row"><span class="total-label">Subtotal Productos</span><span class="total-value" id="total-items-subtotal">$0</span></div>
                        <div class="total-row"><span class="total-label">Descuento General</span><span class="total-value" id="total-general-discount">$0</span></div>
                        <div class="total-row" style="border-top:1px solid var(--border);padding-top:8px"><span class="total-label">Subtotal con Descuento</span><span class="total-value" id="total-after-discount">$0</span></div>
                        <div class="total-row"><span class="total-label">IVA (19%)</span><span class="total-value" id="total-iva">$0</span></div>
                        <div class="total-row highlight"><span class="total-label">TOTAL OFERTA</span><span class="total-value" id="total-grand">$0</span></div>
                    </div>
                </div>
            </div>
            <div class="modal-footer"><button class="btn btn-secondary" onclick="closeModal('modal-quote')">Cancelar</button><button class="btn btn-primary" onclick="saveQuoteFromModal()">Guardar Cotizaci√≥n</button></div>
        </div>
    </div>
    <!-- Modal: Cliente -->
    <div class="modal-overlay" id="modal-client">
        <div class="modal" style="max-width:600px">
            <div class="modal-header"><h2 class="modal-title" id="client-modal-title">Nuevo Cliente</h2><div class="modal-close" onclick="closeModal('modal-client')">‚úï</div></div>
            <div class="modal-body">
                <input type="hidden" id="client-edit-id">
                <div class="form-row"><div class="form-group"><label class="form-label">Empresa *</label><input type="text" class="form-input" id="client-name"></div><div class="form-group"><label class="form-label">NIT *</label><input type="text" class="form-input" id="client-nit"></div></div>
                <div class="form-row"><div class="form-group"><label class="form-label">Contacto</label><input type="text" class="form-input" id="client-contact"></div><div class="form-group"><label class="form-label">Tel√©fono</label><input type="text" class="form-input" id="client-phone"></div></div>
                <div class="form-row"><div class="form-group"><label class="form-label">Email</label><input type="email" class="form-input" id="client-email"></div><div class="form-group"><label class="form-label">Ciudad</label><input type="text" class="form-input" id="client-city"></div></div>
            </div>
            <div class="modal-footer"><button class="btn btn-secondary" onclick="closeModal('modal-client')">Cancelar</button><button class="btn btn-primary" onclick="saveClientForm()">Guardar</button></div>
        </div>
    </div>
    <!-- Modal: Material -->
    <div class="modal-overlay" id="modal-material">
        <div class="modal" style="max-width:500px">
            <div class="modal-header"><h2 class="modal-title" id="material-modal-title">Nuevo Material</h2><div class="modal-close" onclick="closeModal('modal-material')">‚úï</div></div>
            <div class="modal-body">
                <input type="hidden" id="material-edit-id">
                <div class="form-group"><label class="form-label">C√≥digo</label><input type="text" class="form-input" id="material-code" placeholder="Auto-generado si se deja vac√≠o"></div>
                <div class="form-group"><label class="form-label">Descripci√≥n *</label><input type="text" class="form-input" id="material-desc"></div>
                <div class="form-group"><label class="form-label">Tipo *</label><select class="form-select" id="material-type"><option value="Perfil">Perfil</option><option value="Viga">Viga</option><option value="L√°mina">L√°mina</option><option value="Platina">Platina</option><option value="Soldadura">Soldadura</option><option value="Pintura">Pintura</option><option value="Fijaci√≥n">Fijaci√≥n</option><option value="Herramienta">Herramienta</option><option value="Malla">Malla</option><option value="Otro">Otro</option></select></div>
                <div class="form-row"><div class="form-group"><label class="form-label">Unidad *</label><select class="form-select" id="material-unit"><option value="UND">UND</option><option value="M">M</option><option value="M2">M2</option><option value="KG">KG</option><option value="GL">GL</option></select></div><div class="form-group"><label class="form-label">Precio Unitario *</label><input type="number" class="form-input" id="material-price"></div></div>
            </div>
            <div class="modal-footer"><button class="btn btn-secondary" onclick="closeModal('modal-material')">Cancelar</button><button class="btn btn-primary" onclick="saveMaterialForm()">Guardar</button></div>
        </div>
    </div>
    <!-- Modal: Mano de Obra -->
    <div class="modal-overlay" id="modal-labor">
        <div class="modal" style="max-width:500px">
            <div class="modal-header"><h2 class="modal-title" id="labor-modal-title">Nueva Actividad</h2><div class="modal-close" onclick="closeModal('modal-labor')">‚úï</div></div>
            <div class="modal-body">
                <input type="hidden" id="labor-edit-id">
                <div class="form-group"><label class="form-label">C√≥digo</label><input type="text" class="form-input" id="labor-code" placeholder="Auto-generado si se deja vac√≠o"></div>
                <div class="form-group"><label class="form-label">Actividad *</label><input type="text" class="form-input" id="labor-desc"></div>
                <div class="form-row"><div class="form-group"><label class="form-label">Tipo *</label><select class="form-select" id="labor-type"><option value="fabricacion">Fabricaci√≥n</option><option value="instalacion">Instalaci√≥n</option></select></div><div class="form-group"><label class="form-label">Unidad *</label><select class="form-select" id="labor-unit"><option value="JOR">JOR</option><option value="M2">M2</option><option value="M">M</option><option value="UND">UND</option></select></div></div>
                <div class="form-group"><label class="form-label">Costo Base *</label><input type="number" class="form-input" id="labor-cost" value="25000"></div>
            </div>
            <div class="modal-footer"><button class="btn btn-secondary" onclick="closeModal('modal-labor')">Cancelar</button><button class="btn btn-primary" onclick="saveLaborForm()">Guardar</button></div>
        </div>
    </div>
    <!-- Modal: Producto -->
    <div class="modal-overlay" id="modal-product">
        <div class="modal" style="max-width:900px">
            <div class="modal-header">
                <h2 class="modal-title" id="product-modal-title">Nuevo Producto/Servicio</h2>
                <div class="modal-close" onclick="closeModal('modal-product')">‚úï</div>
            </div>
            <div class="modal-body">
                <input type="hidden" id="product-edit-id">

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Tipo *</label>
                        <select class="form-select" id="product-type" onchange="onProductTypeChange()">
                            <option value="producto">Producto</option>
                            <option value="servicio">Servicio</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">C√≥digo</label>
                        <input type="text" class="form-input" id="product-code" readonly style="background:#f5f5f5">
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Nombre *</label>
                    <input type="text" class="form-input" id="product-name" placeholder="Ej: Escalera Met√°lica Tipo Industrial 3m">
                </div>

                <div id="product-materials-section">
                    <div style="display:flex;justify-content:space-between;align-items:center;margin:20px 0 10px">
                        <h3 style="font-size:16px;font-weight:600;margin:0">Materiales</h3>
                        <button type="button" class="btn btn-secondary btn-sm" onclick="addProductMaterialLine()">+ Agregar Material</button>
                    </div>
                    <div class="table-container">
                        <table style="font-size:13px">
                            <thead>
                                <tr>
                                    <th style="width:40%">Material</th>
                                    <th style="width:15%">Cantidad</th>
                                    <th style="width:20%">Precio Unit.</th>
                                    <th style="width:20%">Subtotal</th>
                                    <th style="width:5%"></th>
                                </tr>
                            </thead>
                            <tbody id="product-materials-lines"></tbody>
                        </table>
                    </div>
                </div>

                <div style="display:flex;justify-content:space-between;align-items:center;margin:20px 0 10px">
                    <h3 style="font-size:16px;font-weight:600;margin:0">Mano de Obra</h3>
                    <button type="button" class="btn btn-secondary btn-sm" onclick="addProductLaborLine()">+ Agregar Actividad</button>
                </div>
                <div class="table-container">
                    <table style="font-size:13px">
                        <thead>
                            <tr>
                                <th style="width:40%">Actividad</th>
                                <th style="width:15%">Cantidad</th>
                                <th style="width:20%">Costo Unit.</th>
                                <th style="width:20%">Subtotal</th>
                                <th style="width:5%"></th>
                            </tr>
                        </thead>
                        <tbody id="product-labor-lines"></tbody>
                    </table>
                </div>

                <div style="margin-top:20px;padding:15px;background:#f8f9fa;border-radius:6px">
                    <div style="display:flex;justify-content:space-between;align-items:center">
                        <span style="font-weight:600;font-size:15px">Precio Unitario Calculado:</span>
                        <span style="font-size:18px;font-weight:700;color:#2563eb" id="product-unit-price">$0</span>
                    </div>
                    <div style="font-size:12px;color:#666;margin-top:5px" id="product-price-note">
                        Incluye margen de suministro
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('modal-product')">Cancelar</button>
                <button class="btn btn-primary" onclick="saveProductFromModal()">Guardar</button>
            </div>
        </div>
    </div>
    <!-- Modal: PDF -->
    <div class="modal-overlay" id="modal-pdf">
        <div class="modal" style="max-width:850px">
            <div class="modal-header"><h2 class="modal-title">Vista Previa</h2><div class="modal-close" onclick="closeModal('modal-pdf')">‚úï</div></div>
            <div class="modal-body">
                <div class="tabs" id="pdf-tabs"><div class="tab active" data-pdftab="resumen">Resumen (Cliente)</div><div class="tab" data-pdftab="detalle">Detalle (Interno)</div></div>
                <div id="pdf-content"></div>
            </div>
            <div class="modal-footer"><button class="btn btn-secondary" onclick="closeModal('modal-pdf')">Cerrar</button><button class="btn btn-primary" onclick="exportPDF()">Exportar PDF</button></div>
        </div>
    </div>

    <!-- Modal: Google Sheets Setup -->
    <div class="modal-overlay" id="modal-google-setup">
        <div class="modal" style="max-width:700px">
            <div class="modal-header">
                <h2 class="modal-title">Configurar Sincronizaci√≥n con Google Sheets</h2>
                <div class="modal-close" onclick="closeModal('modal-google-setup')">‚úï</div>
            </div>
            <div class="modal-body">
                <div id="google-auth-status" class="card" style="margin-bottom:20px;padding:20px;text-align:center">
                    <div id="google-not-authenticated" style="display:block">
                        <p style="margin-bottom:16px;color:var(--text-secondary)">
                            Conecta tu cuenta de Google para sincronizar tus datos con Google Sheets
                        </p>
                        <button class="btn btn-primary" onclick="signInGoogle()" id="google-signin-btn">
                            <svg style="width:18px;height:18px;margin-right:8px" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" fill="#4285F4"/>
                                <path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/>
                                <path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"/>
                                <path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/>
                            </svg>
                            Iniciar sesi√≥n con Google
                        </button>
                    </div>
                    <div id="google-authenticated" style="display:none">
                        <div style="display:flex;align-items:center;justify-content:center;gap:12px;margin-bottom:16px">
                            <svg style="width:24px;height:24px;color:var(--success)" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
                            </svg>
                            <span style="font-weight:600;color:var(--success)">Conectado como</span>
                        </div>
                        <p id="google-user-email" style="margin-bottom:16px;font-weight:600"></p>
                        <button class="btn btn-secondary btn-sm" onclick="signOutGoogle()">Cerrar sesi√≥n</button>
                    </div>
                </div>

                <div id="google-sync-options" style="display:none">
                    <h3 style="margin:0 0 16px 0;font-size:14px;font-weight:600;color:var(--text-secondary)">Opciones de Sincronizaci√≥n Inicial</h3>

                    <div style="display:grid;gap:12px">
                        <div class="card" style="padding:16px;cursor:pointer;border:2px solid var(--border);transition:all 0.15s" onclick="selectSyncOption('pull')" id="option-pull">
                            <div style="display:flex;gap:12px">
                                <input type="radio" name="sync-option" value="pull">
                                <div>
                                    <strong style="display:block;margin-bottom:4px">Descargar desde Google Sheets</strong>
                                    <small style="color:var(--text-secondary)">Reemplazar datos locales con los datos de Google Sheets</small>
                                </div>
                            </div>
                        </div>

                        <div class="card" style="padding:16px;cursor:pointer;border:2px solid var(--border);transition:all 0.15s" onclick="selectSyncOption('push')" id="option-push">
                            <div style="display:flex;gap:12px">
                                <input type="radio" name="sync-option" value="push">
                                <div>
                                    <strong style="display:block;margin-bottom:4px">Subir datos locales a Google Sheets</strong>
                                    <small style="color:var(--text-secondary)">Enviar datos actuales a Google Sheets (recomendado para primera vez)</small>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div style="margin-top:20px;padding:16px;background:var(--bg-tertiary);border-radius:8px">
                        <p style="margin:0;font-size:13px;color:var(--text-secondary)">
                            üí° <strong>Nota:</strong> Despu√©s de la sincronizaci√≥n inicial, los cambios se sincronizar√°n autom√°ticamente.
                        </p>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('modal-google-setup')">Cancelar</button>
                <button class="btn btn-primary" id="google-initialize-btn" style="display:none" onclick="initializeGoogleSync()">
                    Inicializar Sincronizaci√≥n
                </button>
            </div>
        </div>
    </div>

    <!-- JavaScript Modules -->
    <script src="js/utils.js"></script>
    <script src="js/data.js"></script>
    <script src="js/calculations.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/catalogs.js"></script>
    <script src="js/products.js"></script>
    <script src="js/quote-actions.js"></script>
    <script src="js/quotes.js"></script>
    <script src="js/pdf.js"></script>
    <!-- Google Sheets Integration (type="module" es importante) -->
    <script type="module" src="js/google-integration.js"></script>
    <script src="js/app.js"></script>
</body>
</html>
